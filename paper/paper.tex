\documentclass{sigchi}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}				% special symbols
\usepackage{fancyhdr}					% headers and footers
\usepackage{verbatim}					% for comments
\usepackage{graphicx}					% images
\usepackage[font=footnotesize]{caption}	% smaller image label
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor} 					% highlighting
\usepackage{amsmath}	    			% maths
\usepackage{relsize}

\usepackage[hyperref=true,style=sigchi,backend=biber,doititles]{biblatex}
\usepackage{filecontents}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage[ruled,vlined]{algorithm2e}

\usepackage{balance}  % to better equalize the last page
\usepackage{times}    % comment if you want LaTeX's default font
\usepackage{url}      % llt: nicely formatted URLs

\usepackage{listings}

\lstset{language=C++,
    basicstyle=\footnotesize\ttfamily,
    keywordstyle=\bfseries\color{blue},%
    showstringspaces=false,
    breaklines=true,%
    morekeywords={include, printf},
	backgroundcolor=\color{lightgray},
    identifierstyle=\color{black},%
    stringstyle=\color{DarkOrchid},
    commentstyle=\color{Green},%
    numbers=left,
    numberstyle={\tiny \color{black}},
    numbersep=9pt,
    emph=[1]{for,if,else,switch,case,while,return},emphstyle=[1]\color{red},
	stepnumber=5,
	tabsize=2
}




% llt: Define a global style for URLs, rather that the default one
\makeatletter
\def\url@leostyle{%
  \@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\small\bf\ttfamily}}}
\makeatother
\urlstyle{leo}


% To make various LaTeX processors do the right thing with page size.
\def\pprw{8.5in}
\def\pprh{11in}
\special{papersize=\pprw,\pprh}
\setlength{\paperwidth}{\pprw}
\setlength{\paperheight}{\pprh}
\setlength{\pdfpagewidth}{\pprw}
\setlength{\pdfpageheight}{\pprh}

% Make sure hyperref comes last of your loaded packages, 
% to give it a fighting chance of not being over-written, 
% since its job is to redefine many LaTeX commands.
\usepackage[pdftex]{hyperref}
\hypersetup{
pdftitle={SIGCHI Conference Proceedings Format},
pdfauthor={LaTeX},
pdfkeywords={SIGCHI, proceedings, archival format},
bookmarksnumbered,
pdfstartview={FitH},
colorlinks,
citecolor=black,
filecolor=black,
linkcolor=black,
urlcolor=black,
breaklinks=true,
}

% create a shortcut to typeset table headings
\newcommand\tabhead[1]{\small\textbf{#1}}




%\linespread{2}

% \pagestyle{headings}

\addbibresource{bibliography.bib}


\title{Real Time Fluid Simulation \\ \smaller using Smoothed-Particle Hydrodynamics and OpenGL}

\subtitle{Computer Graphics CS 488}

\numberofauthors{2}
\author{
  \alignauthor Matthias Untergassmair\\
    \email{munter2@uic.edu}\\
  \alignauthor Michael Berg\\
    \email{mberg4@uic.edu}\\
}


\begin{document}

\maketitle


\begin{abstract}
	This paper explores the field of Smooth Particle Hydrodynamics (SPH), starting at its 
beginnings as a tool to simulate astrophysical phenomena and following its evolution and 
implementation as a way to simulate fluids such as water. We will then give a brief 
mathematical background and ensuing algorithm of our SPH simulation followed by a detailed 
explanation of it.
\end{abstract}


\keywords{
	SPH, Smoothed Particle Hydrodynamics, OpenGL, Fluid Simulation, Real Time
}

Download code at
\begin{center}
	\url{https://github.com/munter2/RealTimeFluid}
\end{center}

\clearpage

\section{Introduction}
%
\hspace{6 pt} Smoothed Particle Hydrodynamics (SPH) successfully simulates fluids by breaking up a 
fluid body into individual parts, or particles. These particles together form a particle 
system that simulates various gravitational forces. Fluid movement is simulated in the 
system by moving particles around any particle moved, simulating a rippling, wave effect.
\\
\hspace*{6 pt} The ripple effect is created by first calculating which particles are surrounding 
a particle moved, and these surrounding particles are moved according to the movement 
of the first particle moved. But SPH wasn't originally intended to simulate liquid 
substances, but astrophysical phenomena.
%

\section{History}
%
\hspace{6 pt} Given all the different applications for Smoothed Particle Hydrodynamics (SPH),
it was first used to simulate interstellar phenomena. Conceived in 1977 by Gingold and 
Monaghan was an improvement to the Standard Finite Difference Method, which until their 
breakthrough, was the method to use to simulate astrophysical phenomena. They improved 
on this method by making "use of Lagrangian description of fluid flow which automatically 
focuses attention on fluid elements" \cite{sphastrophysics}. In this implementation, particles 
"move according to the Newtonian equations with forces due to the pressure gradient and 
other body forces: gravity, rotation and magnetic" \cite{sphastrophysics}.
\\
\hspace*{6 pt} The set of equations utilized in Gingold and Monaghan's SPH implementation 
is a density distribution calculated at each point
\begin{align}
	\rho_s(r) = \int W(r - r') \rho(r') dr'
\end{align}
where W is a function satisfying the condition
\begin{align}
\int W(r) dr = 1
\end{align}
\hspace*{6 pt} This density distribution equation is used to calculate the density of the 
particles surrounding the current particle the equation it's being applied to.
\hspace*{6 pt} A Gaussian function is used for the kernel function, with the form
\begin{align}
(\frac{1}{\pi h^2})^\frac{3}{2}  \exp{(\frac{-r^2}{h^2})}
\end{align}
and h is
\begin{align}
h = b(<r^2> - <r>^2)^\frac{1}{2}
\end{align}
and \textit{b} is adjustable.
\hspace*{6 pt} The gravitational potential of the particles is denoted by
\begin{align}
\phi = - G \int \frac{\rho_N(r')}{|r - r'|} dr'
\end{align}
with G being the gravitational constant. Substituting in eq. 1 turns the equation 
of gravitational potential into
\begin{align}
\phi = - \frac{GM}{N} \sum_{j=1}^N \int \frac{W(r - r')}{|r - r'|} dr'
\end{align}
To finish the equation, starting with
\begin{align}
\triangledown^2I_j = -4 \pi W(r - r_j)
\end{align}
substituting gravitational potential for I
\begin{align}
\triangledown \rho = - \frac{GM}{N} \sum_{j=1}^N \left \lbrace - \frac{4 \pi}{u_j^2} \int_{0}^{u_j} 
W(u) u^2 du \right \rbrace \triangledown u_j
\end{align}
where
\begin{align}
u_j = r - r_j
\end{align}
Adding in the Gaussian Function in eq. 3 for W yields
\begin{align}
\triangledown \phi = - \frac{GM}{N} \sum_{j=1}^N \frac{2}{u_j} \left ( \frac{f}{\pi} \right )^\frac{1}{2} 
\left \lbrack \exp{(-f u_j^2)} - \frac{1}{u_j} \int_{0}^{u_j} \exp{(-f u^2)} du \right \rbrack 
\triangledown u_j
\end{align}
This equation is the full solution to calculating the gravitational potential of all particles
involved in the simulation.
\\
\hspace*{6 pt} The result of Gingold and Monaghan's theory and implementation was a robust 
and extendable idea that could easily made more accurate "by increasing the number of particles 
and by using the devices known to improve Monte Carlo integration methods" \cite{sphastrophysics}.
%

\section{Smoothed Particle Hydrodynamics Overview}
%

%

\section{Mathematical Background}
%
\begin{align}
	a_i^n = \frac{F_i^n}{m_i} = \dots
	\label{math:acceleration}
\end{align}

\section{The Algorithm}
%
In the following, we denote the position for the particle $i$ at time $t$ as $x_i^t$, its velocity as $v_i^t$ and its acceleration as $a_i^t$.
We omit the vector notation ($\boldsymbol{x},\boldsymbol{v},\boldsymbol{a}$) for these quantities, since the following equations are valid for the vectors as well as for each component individually.
\par\medskip
%
As suggested in \cite{generalizedwallboundary}, we use the \emph{Velocity-Verlet} time stepping scheme as follows:
%
\begin{algorithm}
	\caption{Single Timestep with Velocity Verlet Algorithm}
	\KwData{$x_i^t$, $v_i^{t - \frac{\Delta t}{2}}$, $a_i^t$, $\Delta t$}
	\KwResult{$x_i^{t + \Delta t}$, $v_i^{t + \frac{\Delta t}{2}}$, $a_i^{t + \Delta t}$}	
	$v_i^{t+\frac{\Delta t}{2}} = v_i^{t - \frac{\Delta t}{2}} + \Delta t a_i^t$ \;
	$x_i^{t+\Delta t} = x_i^t + \Delta t v_i^{t+\frac{\Delta t}{2}}$ \;	
	$a_i^{t + \Delta t} = a_i^{t + \Delta t} (x_i^{t + \Delta t}, m_i)$ from equation \ref{math:acceleration} \;
\end{algorithm}

\balance

\nocite{*}
\printbibliography

\clearpage
\begin{comment}
\clearpage

\section*{Appendix: Code}

\lstinputlisting[caption=sphModel.hpp]{../sphModel.hpp}
\lstinputlisting[caption=sphModel.cpp]{../sphModel.cpp}
\lstinputlisting[caption=Simulation.cpp]{../Simulation.cpp}
\lstinputlisting[caption=simulation.vsh]{../resources/simulation.vsh}
\lstinputlisting[caption=simulation.fsh]{../resources/simulation.fsh}

\end{comment}






As a kernel function we used the standard kernel, the \emph{cubic spline}
\begin{align*}
	W_3(r,h) := \frac{1}{\pi h^3}
	\begin{cases}
		1 - \frac{3}{2} \xi^2 + \frac{3}{4} \xi^3, &\text{for } 0 \le \xi < 1 \\
		\frac{1}{4} (2-\xi)^3, &\text{for } 1 \le \xi < 2 \\
		0, &\text{otherwise}
	\end{cases}
\end{align*}
%
where $\xi := \frac{r}{h}$. It can be seen clearly that the support of this function is $2h$. \\
The derivative is
%
\begin{align*}
	\nabla W_3(r,h) &= \frac{\partial}{\partial r} W_3(r,h) + \frac{\partial}{\partial h} W_3(r,h)
\end{align*}
%
\begin{itemize}
	\item for $0 \le \xi < 1$
		\begin{align*}
			\frac{\partial}{\partial r} W_3(r,h)|_{0 \le \xi < 1}
			&= \frac{1}{\pi h^3} \frac{1}{h} \left( 3 \xi + \frac{9}{4} \xi^2 \right)
		\end{align*}
		%
		\begin{align*}
			\frac{\partial}{\partial h} W_3(r,h)|_{0 \le \xi < 1}
			&= \frac{-3}{\pi h^4} \left( 1 - \frac{3}{2} \xi^2 + \frac{3}{4} \xi^3 \right) \\
			&\quad + \frac{1}{\pi h^3} \frac{1}{r} \left( (-2) \frac{3}{2} \xi^3 + (-3)\frac{3}{4} \xi^4 \right) \\
			&= - \frac{3}{\pi h^4} \left( 1 - \frac{3}{2} \xi^2 + \frac{3}{4} \xi^3 \right) \\
			&\quad + \frac{1}{\pi h^3} \frac{1}{r} \left( -3 \xi^3 -\frac{9}{4} \xi^4 \right)
		\end{align*}
		%
		\begin{align*}
			\Rightarrow \nabla W_3(r,h)|_{0 \le \xi < 1}
		&= \frac{1}{\pi h^4} \left( 3 \xi + \frac{9}{4} \xi^2 \right) \\
			&- \frac{3}{\pi h^4} \left( 1 - \frac{3}{2} \xi^2 + \frac{3}{4} \xi^3 \right) \\
			&\quad + \frac{1}{\pi h^3} \frac{1}{r} \left( -3 \xi^3 -\frac{9}{4} \xi^4 \right) \\
		&= \frac{3}{\pi h^4} \left( -1 + \xi + \frac{9}{4} \xi^2
			- \frac{3}{4} \xi^3 \right) \\
			&\quad - \frac{1}{\pi r h^3} \xi^3 \left( 3 + \frac{9}{4} \xi \right)
	\end{align*}
	\item for $1 \le \xi < 2$
		\begin{align*}
			\frac{\partial}{\partial r} W_3(r,h)|_{1 \le \xi < 2}
			&= \frac{1}{4} 3(2-\xi)^2 \cdot \left( -\frac{1}{h} \right) \\
			&= -\frac{3}{4h} (2-\xi)^2
		\end{align*}
		%
		\begin{align*}
			\frac{\partial}{\partial h} W_3(r,h)|_{1 \le \xi < 2}
			&= \frac{1}{4} 3(2-\xi)^2 \cdot \left( +\frac{\xi}{h} \right) \\
			&= \frac{3 \xi}{4 h} (2-\xi)^2
		\end{align*}
		\begin{align*}
			\Rightarrow \nabla W_3(r,h)|_{1 \le \xi < 2}
			&= -\frac{3}{4h} (2-\xi)^2
			+ \frac{3 \xi}{4 h} (2-\xi)^2 \\
			&= \frac{3}{4h} (2-\xi)^2 (\xi - 1)
		\end{align*}
	\item otherwise
		\begin{align*}
			\nabla W_3(r,h)|_{\text{otherwise}} = 0
		\end{align*}
\end{itemize}
%
The following two code snippets show how these formulas are implemented in our simulation:
\begin{lstlisting}[caption=Cubic Spline]
// Cubic spline function
inline float W3(float r, float h) {
	float W = 0;
	float zeta = r/h;
	if(0 <= zeta && zeta <= 2) {
		W = (zeta < 1 ? 
				1 - .75*zeta*zeta*(2+zeta) :
				.25*(2-zeta)*(2-zeta)*(2-zeta)
		);
	}
	W /= (M_PI*h*h*h);
	return W;
}
\end{lstlisting}
%
\begin{lstlisting}[caption=Derivative of Cubic Spline]
Hello World
\end{lstlisting}




\end{document}
